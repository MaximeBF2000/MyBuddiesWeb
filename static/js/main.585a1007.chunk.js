(this.webpackJsonpPotesAppWeb=this.webpackJsonpPotesAppWeb||[]).push([[0],{65:function(e,n,t){},75:function(e,n,t){"use strict";t.r(n);var a=t(3),s=t(2),c=t(13),o=t.n(c),i=t(18),r=t(9),l={user:null,conversations:[],currentConversation:null},d=function(e,n){var t=n.type,a=n.payload;switch(t){case"SET_USER":return Object(i.a)(Object(i.a)({},e),{},{user:a});case"SET_CURRENT_CONVERSATION":return Object(i.a)(Object(i.a)({},e),{},{currentConversation:a});default:return e}},u=Object(s.createContext)(l),j=function(e){var n=e.children,t=Object(s.useReducer)(d,l),c=Object(r.a)(t,2),o=c[0],j=c[1];return Object(a.jsx)(u.Provider,{value:Object(i.a)(Object(i.a)({},o),{},{dispatch:j}),children:n})},p=function(){return Object(s.useContext)(u)},m=(t(42),t(65),t(41)),v=t.n(m),b=t(48),O=t(32);t(68),t(69);O.a.initializeApp({apiKey:"AIzaSyD4dqP2NyaaEmG2Et8NfmqxSKDmO1Kd0pM",authDomain:"potesapp-reactnative.firebaseapp.com",databaseURL:"https://potesapp-reactnative.firebaseio.com",projectId:"potesapp-reactnative",storageBucket:"potesapp-reactnative.appspot.com",messagingSenderId:"277331562406",appId:"1:277331562406:web:35e1adf83e676b047b8967"});var h=O.a.firestore(),f=new O.a.auth.GoogleAuthProvider;function x(){var e=p().dispatch,n=function(){var n=Object(b.a)(v.a.mark((function n(){var t;return v.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,O.a.auth().signInWithPopup(f);case 3:t=n.sent,e({type:"SET_USER",payload:t.user}),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.error(n.t0.message);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(){return n.apply(this,arguments)}}();return Object(a.jsx)("div",{className:"login",children:Object(a.jsxs)("div",{className:"box",children:[Object(a.jsx)("h1",{className:"title",children:"MyBuddies Web - Login"}),Object(a.jsx)("button",{className:"loginBtn",onClick:n,children:"Login with Google"})]})})}function N(e){var n=Object(s.useState)([]),t=Object(r.a)(n,2),a=t[0],c=t[1];return Object(s.useEffect)((function(){var n=h.collection(e).onSnapshot((function(e){var n=[];e.docs.forEach((function(e){return n.push(Object(i.a)({},e.data()))})),c(n)}));return function(){return n()}}),[e]),a}function g(e){var n=e.conversation,t=p().dispatch;return Object(a.jsxs)("div",{className:"sidebarConversation",onClick:function(){t({type:"SET_CURRENT_CONVERSATION",payload:n})},children:[Object(a.jsx)("img",{src:(null===n||void 0===n?void 0:n.img)||"https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Unknown_person.jpg/1200px-Unknown_person.jpg",alt:"Picture of the conversation",className:"conversationImg"}),Object(a.jsxs)("div",{className:"conversationInfos",children:[Object(a.jsx)("div",{className:"conversationTitle",children:null===n||void 0===n?void 0:n.title}),Object(a.jsx)("p",{className:"conversationLastText",children:(null===n||void 0===n?void 0:n.messages[(null===n||void 0===n?void 0:n.messages.lenght)-1])||"There is no message here."})]})]})}var C=t(96),S=t(49),y=t.n(S);function E(){var e=Object(s.useState)(""),n=Object(r.a)(e,2),t=n[0],c=n[1],o=p().user;return Object(a.jsxs)("form",{className:"sidebarFooter",onSubmit:function(e){e.preventDefault();var n=Object(C.a)();h.collection("conversations").doc(n).set({id:n,title:t,photoUrl:"",peopleIncluded:[{name:o.displayName,email:o.email}],messages:[]}),c("")},children:[Object(a.jsx)("input",{type:"text",className:"addConversationInput",placeholder:"Add a new conversation here...",value:t,onChange:function(e){return c(e.target.value)}}),Object(a.jsx)("button",{type:"submit",className:"addConvSubBtn",children:Object(a.jsx)(y.a,{className:"addConvSubIcon",fontSize:"large"})})]})}function I(){var e=p().user,n=N("conversations");return Object(a.jsxs)("aside",{className:"sidebar",children:[Object(a.jsxs)("div",{className:"sidebarTop",children:[Object(a.jsx)("img",{src:(null===e||void 0===e?void 0:e.photoURL)||"https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Unknown_person.jpg/1200px-Unknown_person.jpg",alt:"Profil picture",className:"sidebarProfilPhoto"}),Object(a.jsxs)("h2",{className:"sidebarInfo",children:["Welcome, ",null===e||void 0===e?void 0:e.displayName]})]}),Object(a.jsx)("div",{className:"sidebarMain",children:n.map((function(n,t){if(null===n||void 0===n?void 0:n.peopleIncluded.find((function(n){return n.email===(null===e||void 0===e?void 0:e.email)})))return Object(a.jsx)(g,{conversation:n},t)}))}),Object(a.jsx)(E,{})]})}var T=t(91),R=t(92),w=t(94),k=t(95);function _(e){var n=e.isOpen,t=e.onClose,s=p(),c=s.currentConversation,o=s.dispatch;return Object(a.jsx)(w.a,{className:"modal deleteConvModal",open:n,onClose:t,children:Object(a.jsxs)("div",{className:"box",children:[Object(a.jsxs)("h3",{className:"modalTitle",children:["Are you sure you want to delete the conversation :"," ",null===c||void 0===c?void 0:c.title]}),Object(a.jsxs)("div",{className:"actionButtons",children:[Object(a.jsx)(k.a,{className:"button deleteBtn",onClick:function(){h.collection("conversations").doc(c.id).delete().then((function(){o({type:"SET_CURRENT_CONVERSATION",payload:null}),t()}))},variant:"outlined",color:"primary",children:"Yes, Delete"}),Object(a.jsx)(k.a,{className:"button cancelBtn",onClick:function(){return t()},variant:"outlined",color:"secondary",children:"No, Cancel"})]})]})})}var U=t(54),A=t.n(U),B=t(37);function P(){var e=Object(s.useState)(""),n=Object(r.a)(e,2),t=n[0],c=n[1],o=Object(s.useState)(""),i=Object(r.a)(o,2),l=i[0],d=i[1],u=p(),j=u.currentConversation,m=u.user,v=u.dispatch;return Object(a.jsxs)("form",{className:"addUser",onSubmit:function(e){return e.preventDefault(),console.log({name:t,email:l}),t&&l?l===m.email?alert("The user is already in the conversation"):void h.collection("conversations").doc(j.id).update({peopleIncluded:[].concat(Object(B.a)(j.peopleIncluded),[{name:t,email:l}])}).then((function(){h.collection("conversations").doc(j.id).get().then((function(e){v({type:"SET_CURRENT_CONVERSATION",payload:e.data()})}))})):alert("A user must have a name and a valid email adress")},children:[Object(a.jsx)("input",{type:"text",className:"nameInput input",value:t,onChange:function(e){return c(e.target.value)},placeholder:"User display name..."}),Object(a.jsx)("input",{type:"text",className:"mailInput input",value:l,onChange:function(e){return d(e.target.value)},placeholder:"User email..."}),Object(a.jsx)("button",{type:"submit",className:"submitBtn",children:"Add user"})]})}function M(e){var n,t=e.isOpen,s=e.onClose,c=p(),o=c.currentConversation,i=c.user,r=c.dispatch;return Object(a.jsx)(w.a,{className:"modal managePeopleModal",open:t,onClose:s,children:Object(a.jsxs)("div",{className:"box",children:[Object(a.jsx)("h3",{className:"modalTitle",children:"People in the conversation"}),Object(a.jsx)("div",{className:"peopleList",children:null===o||void 0===o||null===(n=o.peopleIncluded)||void 0===n?void 0:n.map((function(e,n){return Object(a.jsxs)("div",{className:"peopleItem",children:[Object(a.jsxs)("div",{className:"info",children:[Object(a.jsx)("div",{className:"name",children:e.name}),Object(a.jsx)("div",{className:"email",children:e.email})]}),Object(a.jsx)(A.a,{className:"deleteBtn",onClick:function(){return function(e){var n;h.collection("conversations").doc(o.id).update({peopleIncluded:null===o||void 0===o||null===(n=o.peopleIncluded)||void 0===n?void 0:n.filter((function(n){return n.email!==e}))}).then((function(){h.collection("conversations").doc(o.id).get().then((function(n){i.email===e?r({type:"SET_CURRENT_CONVERSATION",payload:null}):r({type:"SET_CURRENT_CONVERSATION",payload:n.data()})}))}))}(e.email)}})]},n)}))}),Object(a.jsx)(P,{})]})})}function V(){var e=Object(s.useState)(!1),n=Object(r.a)(e,2),t=n[0],c=n[1],o=Object(s.useState)(!1),i=Object(r.a)(o,2),l=i[0],d=i[1],u=p(),j=u.currentConversation,m=u.dispatch;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{className:"messagesHeader",children:[Object(a.jsx)("div",{className:"convTitle",children:(null===j||void 0===j?void 0:j.title)||"No conversation selected"}),Object(a.jsxs)("div",{className:"manageConv",children:[Object(a.jsx)("span",{title:"Manage people in the group",children:Object(a.jsx)(T.a,{className:"managePeopleBtn handleConvBtn",onClick:function(){j&&c(!0)}})}),Object(a.jsx)("span",{title:"Delete the conversation (irreversible)",children:Object(a.jsx)(R.a,{className:"deleteConvBtn handleConvBtn",onClick:function(){j&&d(!0)}})}),Object(a.jsx)("button",{className:"logOutBtn",onClick:function(){O.a.auth().signOut().then((function(){return m({type:"SET_USER",payload:null})}))},children:"Sign Out"})]})]}),Object(a.jsx)(M,{isOpen:t,onClose:function(){return c(!1)}}),Object(a.jsx)(_,{isOpen:l,onClose:function(){return d(!1)}})]})}var D=t(93);function F(){var e=Object(s.useState)(""),n=Object(r.a)(e,2),t=n[0],c=n[1],o=p(),i=o.currentConversation,l=o.user,d=o.dispatch;return Object(a.jsxs)("form",{className:"messageFooter",onSubmit:function(e){e.preventDefault(),t&&(i?(h.collection("conversations").doc(i.id).update({messages:[].concat(Object(B.a)(i.messages),[{from:{name:null===i||void 0===i?void 0:i.peopleIncluded.find((function(e){return e.email===l.email})).name,email:l.email},content:t}])}).then((function(){h.collection("conversations").doc(i.id).get().then((function(e){d({type:"SET_CURRENT_CONVERSATION",payload:e.data()})}))})),c("")):alert("You need to be in a conversation to write a message"))},children:[Object(a.jsx)("input",{type:"text",className:"addMessageInput",placeholder:"Add a new message here...",value:t,onChange:function(e){return c(e.target.value)}}),Object(a.jsx)("button",{type:"submit",className:"addMsgSubBtn",children:Object(a.jsx)(D.a,{className:"addMsgSubIcon",fontSize:"large"})})]})}function L(){var e,n=Object(s.useState)(null),t=Object(r.a)(n,2),c=t[0],o=t[1],i=p(),l=i.currentConversation,d=i.user,u=N("conversations"),j=Object(s.useRef)(null);return Object(s.useEffect)((function(){setTimeout((function(){return j.current.scrollIntoView()}),500)}),[l]),Object(s.useEffect)((function(){var e=u.find((function(e){return(null===e||void 0===e?void 0:e.id)===(null===l||void 0===l?void 0:l.id)}));o(e),j.current.scrollIntoView()}),[u,l]),Object(a.jsxs)("div",{className:"messageContainer",children:[Object(a.jsx)(V,{}),Object(a.jsxs)("div",{className:"messages",children:[null===c||void 0===c||null===(e=c.messages)||void 0===e?void 0:e.map((function(e,n){return Object(a.jsxs)("div",{className:"singleMessage ".concat((null===e||void 0===e?void 0:e.from.email)===d.email?"fromMe":"fromOther"),children:[Object(a.jsx)("span",{className:"msgFrom",children:null===e||void 0===e?void 0:e.from.name}),Object(a.jsx)("p",{className:"msgContent",children:e.content})]},n)})),Object(a.jsx)("div",{ref:j})]}),Object(a.jsx)(F,{})]})}function W(){var e=p().user;return Object(a.jsx)(a.Fragment,{children:e?Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(I,{}),Object(a.jsx)(L,{})]}):Object(a.jsx)(x,{})})}o.a.render(Object(a.jsx)(j,{children:Object(a.jsx)(W,{})}),document.getElementById("root"))}},[[75,1,2]]]);
//# sourceMappingURL=main.585a1007.chunk.js.map